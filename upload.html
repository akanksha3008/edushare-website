<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Upload File</title>
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.4.1/css/bootstrap.min.css" integrity="sha384-Vkoo8x4CGsO3+Hhxv8T/Q5PaXtkKtu6ug5TOeNV6gBiFeWPGFN9MuhOf23Q9Ifjh" crossorigin="anonymous">
    <!-- <link rel="manifest" href="site.webmanifest"> -->
    <link rel="shortcut icon" type="image/x-icon" href="img/favicon.png">
    <!-- Place favicon.ico in the root directory -->
    <link href="https://fonts.googleapis.com/css?family=Bellota&display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css?family=Poppins&display=swap" rel="stylesheet">
    <!-- CSS here -->
    <link rel="stylesheet" href="css/bootstrap.min.css"> 
    <link rel="stylesheet" href="css/owl.carousel.min.css">
    <link rel="stylesheet" href="css/magnific-popup.css">
    <link rel="stylesheet" href="css/font-awesome.min.css">
    <link rel="stylesheet" href="css/themify-icons.css">
    <link rel="stylesheet" href="css/nice-select.css">
    <link rel="stylesheet" href="css/flaticon.css">
    <link rel="stylesheet" href="css/gijgo.css">
    <link rel="stylesheet" href="css/animate.css">
    <link rel="stylesheet" href="css/slicknav.css">
    <link rel="stylesheet" href="css/style.css">
    <link rel="stylesheet" href="year.css">
    <!-- <link rel="stylesheet" href="css/responsive.css"> -->

    	<!-- Bootstrap CSS -->
	<!-- <link rel="stylesheet" href="css/bootstrap.css"> -->
	<link rel="stylesheet" href="vendors/linericon/style.css">
	<link rel="stylesheet" href="vendors/owl-carousel/owl.carousel.min.css">
	<link rel="stylesheet" href="vendors/lightbox/simpleLightbox.css">
	<link rel="stylesheet" href="vendors/nice-select/css/nice-select.css">
	<link rel="stylesheet" href="vendors/animate-css/animate.css">
	<!-- main css -->
	
    <style>

    </style>
</head>
<body>
  <script src="https://www.gstatic.com/firebasejs/7.13.1/firebase-app.js"></script>
  <script src="https://www.gstatic.com/firebasejs/7.13.1/firebase-analytics.js"></script>
  <script src="https://www.gstatic.com/firebasejs/7.13.1/firebase-storage.js"></script>
  <script src="https://www.gstatic.com/firebasejs/7.13.1/firebase-firestore.js"></script>
  <script src="https://www.gstatic.com/firebasejs/7.13.1/firebase-auth.js"></script>
  <script src="https://code.jquery.com/jquery-3.4.1.slim.min.js" integrity="sha384-J6qa4849blE2+poT4WnyKhv5vZF5SrPo0iEjwBvKU7imGFAV0wwj1yYfoRSJoZ+n" crossorigin="anonymous"></script>
<script src="https://cdn.jsdelivr.net/npm/popper.js@1.16.0/dist/umd/popper.min.js" integrity="sha384-Q6E9RHvbIyZFJoft+2mJbHaEWldlvI9IOYy5n3zV9zzTtmI3UksdQRVvoxMfooAo" crossorigin="anonymous"></script>
<script src="https://stackpath.bootstrapcdn.com/bootstrap/4.4.1/js/bootstrap.min.js" integrity="sha384-wfSDF2E50Y2D1uUdj0O3uMBJnjuUD4Ih7YwaYd1iqfktj0Uod8GCExl3Og8ifwB6" crossorigin="anonymous"></script>

  <script>
    // Your web app's Firebase configuration
    var firebaseConfig = {
      apiKey: "AIzaSyDMd-024ETAuXIWyQ2oZJ5L7tOhtTbAxQI",
      authDomain: "filesharingedi.firebaseapp.com",
      databaseURL: "https://filesharingedi.firebaseio.com",
      projectId: "filesharingedi",
      storageBucket: "filesharingedi.appspot.com",
      messagingSenderId: "478279119993",
      appId: "1:478279119993:web:81b3fb7564a364d697d0a8",
      measurementId: "G-17Z81NY340"
    };
    // Initialize Firebase
    firebase.initializeApp(firebaseConfig);
    firebase.analytics();
  
     // Get a reference to the storage service, which is used to create references in your storage bucket
    // var storage = firebase.storage();
    var user = firebase.auth().currentUser;
            if(user!=null)
            { 
                var t = sessionStorage.getItem("time");
                console.log(user_details);
                if(new Date().getTime()>=t)
                {  alert("Session expired");
                    logout();
                }
            }
  </script>
    <!-- header-start -->
    <header>
      <div class="header-area ">
          <div id="sticky-header" class="main-header-area">
              <div class="container-fluid p-0">
                  <div class="row align-items-center no-gutters">
                      <div class="col-xl-2 col-lg-2">
                          <div class="logo-img">
                              <a href="index.html">
                                  <img src="img/edushare.svg" alt="">
                              </a>
                          </div>
                      </div>
                      <div class="col-xl-7 col-lg-7">
                          <div class="main-menu  d-none d-lg-block">
                              <nav>
                                  <ul id="navigation">
                                      <li><a href="index.html">Home</a></li>
                                      <li><a href="index1.html">Courses</a></li>
                                      
                                      <li><a href="Projects.html">Projects</a></li>

                                      <li><a href="about.html">About</a></li>
                                      
                                      <!-- <li><a href="contact.html">Contact</a></li> -->
                                  </ul>
                              </nav>
                          </div>
                      </div>
                
                      <div class="col-xl-3 col-lg-3 d-none d-lg-block"> 
                          <div class="log_chat_area d-flex align-items-center" id="account">
                              <li>
                                  <a href="loginpage.html" class="boxed_btn_orange" id="loggedin">
                                      <i class="flaticon-user"></i>
                                      <span id="logbutton">Log In</span>
                                  </a>
                              </li>
                          </div>
                      </div> 
                      <div class="col-12">
                          <div class="mobile_menu d-block d-lg-none"></div>
                      </div>
                  </div>
              </div>
          </div>
      </div>
  </header>
  <!-- header-end -->

      <!-- slider_area_start -->
      <div class="slider_area ">
        <div class="single_slider d-flex align-items-center justify-content-center slider_bg_1">
            <div class="container">
                <div class="row align-items-center justify-content-center">
                    <div class="row justify-content-center my-3 card course_element" style="width: 100%;"> 
                        <div class="col-lg-12">
                         Upload File Form
                        </div> 
                    </div>   
                    <section class="feature_area">
                        <div class="container" style="margin-top: 2%; color:black;"> 
                                     
          In first year or not?
          <div class="form-check form-check-inline">
            <input class="form-check-input" type="radio" name="fy" id="radio1" value="yes">
            <label class="form-check-label" style="color:black;" for="inlineRadio1">Yes</label>
          </div>
          <div class="form-check form-check-inline">
            <input class="form-check-input" type="radio" name="fy" id="radio2" value="no">
            <label class="form-check-label" style="color:black;" for="inlineRadio2">No</label>
          </div>

          <script>
            $('input[type=radio][name=fy]').change(function() {
                if (this.value == 'yes') {
                   
                        
                }
                else if (this.value == 'no') {
                    
                    $(".restForm").css("display","block");
                }
            });
          </script>

          <div class="form-group restForm" style="display: none;">
            <label style="color:black;" for="formGroupExampleInput2">Dept name</label>
            <!-- <input type="text" class="form-control" name="subject" id="subject" placeholder="Subject Name"> -->
            <select class="form-control" id="dept">
              <option>Select Department</option>
              <option>Computer</option>
              <option>Mechanical</option>
              <option>Instrumentation</option>
             
            </select>
            <script>
               $("#dept").change(function(){
                  var t = $("#dept").find(":selected").text();
                  alert(t);
                  var subArr=[
                     ['Computer',['Data Structures','DBMS','DAA']],
                     ['Mechanical',['SOM','Fluid Mechanics','Machine Design','Thermodynamics']],
                     ['Instrumentation',['Field Instrumentation','Control System','PCC','Digital Control']]
               ];
                   
               var str = '';
               var subList = subArr.filter(x=>{
                  return x[0]===t;
               });

               console.log(subList[0][1]);
               subList[0][1].forEach(element=>{
                str += `<option>${element}</option>`;
               });
                
               $("#subject").html(str);
               });
             
            </script>
          </div>

          <div class="form-group restForm" style="display: none;">
            <label style="color:black;" for="formGroupExampleInput2">Subject name</label>
            <!-- <input type="text" class="form-control" name="subject" id="subject" placeholder="Subject Name"> -->
            <select class="form-control" id="subject">

            </select>
           
          </div>

          <script>
            $("#subject").change(function(){
              var t = $("#subject").find(":selected").text();
                  alert(t);
            });
          </script>
          <div class="form-group">
            <label style="color:black;" for="formGroupExampleInput2">Description</label>
            <input type="text" class="form-control" name="description" id="description" placeholder="Describe the file..">
          </div>
          <div class="form-group" >
            <label style="color:black;" for="exampleFormControlFile1">Click Button to Upload</label>
            <input type="file" value="Upload" id="fileButton" />
          </div>
          <br>
          <button id="hello" class="btn btn-primary">Submit</button>
        
                        </div>
                    </section>
                </div>
            </div>
        </div>
    </div>
    <!-- slider_area_end -->

        
        <script>

          button = document.getElementById("hello");
          button.addEventListener("click",e=>{
            e.preventDefault();
            var x;
            if (document.getElementById('radio1').checked) 
              x = document.getElementById('radio1').value;
            if (document.getElementById('radio2').checked) 
              x= document.getElementById('radio2').value;

            //var x = document.getElementsByName("fy").value;
          var fileButton = document.getElementById('fileButton');
          var file = fileButton.files[0];
          
          
            console.log(x);
            
            firebase.auth().onAuthStateChanged(function(user) {
        if (user!=null) {
           
          var user = firebase.auth().currentUser;
          var desc = document.getElementById("description").value;
          console.log(file.size);
          if(x==="yes")
          {  console.log(file.name);
            //Listen for file selection

                    var firestore = firebase.firestore();
                    var u = firebase.auth().currentUser;
                    // uploader.setAttribute('visibility','visible');
                    if(u!=null){
                    console.log(u.email);
                    // var file = e.target.files[0];
                    console.log('File size: '+ file.size);
                    //create a storage ref
                    var storageRef =  firebase.storage().ref('firstYear/'+file.name);
                    //upload file
                    var task = storageRef.put(file);
                    //update progress bar
            
                    task.on('state_changed',function progress(snapshot){
            
                    //    var percentage = ((snapshot.bytesTransferred)/snapshot.totalBytes)*100;
                    //    uploader.value = percentage;
            
                    },
                    function error(err){
            
                    },
                    function complete(){
                        //when uploading to storage is completed , we add the url of the file alongwith other details to 
                        //cloud firestore 
                        var obj_url;
                        // console.log(firebase.storage().ref('firstYear/'+file.name).getDownloadURL());
                        firebase.storage().ref('firstYear/'+file.name).getDownloadURL().then(function(url){
                            obj_url = url;
                            console.log(obj_url);
                            var s = Math.round(file.size/1024);
                            const docRef = firestore.doc("filesharingedi/Downloads/firstYear/"+file.name);
                            var n;
                            var desc = document.getElementById("description").value;
                            var a = firebase.auth().currentUser.email;
                            console.log(typeof a);
                            firebase.firestore().collection("Users").where("username","==",a).get().then(
                            function(querySnapshot){
                                querySnapshot.forEach(function(doc){
                                    console.log(doc.id);
                                    console.log(doc.data().name);
                                    n = doc.id;
                                    var data = {
                                    filename : file.name,
                                    size : s,
                                    author : firebase.auth().currentUser.email,
                                    url : obj_url,
                                    count :0, 
                                    about: desc,
                                    five_rating:0,
                                    four_rating:0,
                                    three_rating:0,
                                    two_rating:0,
                                    one_rating:0,
                                    rating:0            
                                    };
                                //putting in cloud firestore database
                                docRef.set(data).then(function(){
                                    // console.log(obj_url);
                                    firebase.firestore().collection("Users").doc(doc.id).update({
                                        upload_count:firebase.firestore.FieldValue.increment(1)
                                    })
                                    console.log("Status saved");
                                }).catch(function(error){
                                    console.log(error);
                                });
                        });        
                    }).catch(function(error){
                            console.log(error);
                        });
                    
            
                        });
            
                        alert('Upload successful');
                        
                    }  );
                }
                else
                alert("Login first");

            
          }
          else if(x==="no")
          {
              var subject =document.getElementById("subject").value;
              console.log(subject);
              var firestore = firebase.firestore();
                    var u = firebase.auth().currentUser;
                    // uploader.setAttribute('visibility','visible');
                    if(u!=null){
                    console.log(u.email);
                    // var file = e.target.files[0];
                    console.log('File size: '+ file.size);
                    //create a storage ref
                    var storageRef =  firebase.storage().ref(subject+'/'+file.name);
                    //upload file
                    var task = storageRef.put(file);
                    task.on('state_changed',function progress(snapshot){
                    },
                    function error(err){
            
                    },
                    function complete(){
                        //when uploading to storage is completed , we add the url of the file alongwith other details to 
                        //cloud firestore 
                        var obj_url;
                       
                        firebase.storage().ref(subject+'/'+file.name).getDownloadURL().then(function(url){
                            obj_url = url;
                            console.log(obj_url);
                            var s = Math.round(file.size/1024);
                            const docRef = firestore.doc("filesharingedi/Downloads/"+subject+"/"+file.name);
                            var n;
                            var desc = document.getElementById("description").value;
                            var a = firebase.auth().currentUser.email;
                            console.log(typeof a);
                            firebase.firestore().collection("Users").where("username","==",a).get().then(
                            function(querySnapshot){
                                querySnapshot.forEach(function(doc){
                                    console.log(doc.id);
                                    console.log(doc.data().name);
                                    n = doc.id;
                                    var data = {
                                    filename : file.name,
                                    size : s,
                                    author : firebase.auth().currentUser.email,
                                    url : obj_url,
                                    count :0,
                                    about:desc,
                                    five_rating:0,
                                    four_rating:0,
                                    three_rating:0,
                                    two_rating:0,
                                    one_rating:0,
                                    rating:0
                                    };
                                //putting in cloud firestore database
                                docRef.set(data).then(function(){
                                   
                                    firebase.firestore().collection("Users").doc(doc.id).update({
                                        upload_count:firebase.firestore.FieldValue.increment(1)
                                    })
                                    console.log("Status saved");
                                }).catch(function(error){
                                    console.log(error);
                                });
                        });        
                    }).catch(function(error){
                            alert(error);
                        });
                    
            
                        });
            
                        alert('Upload successful');
                        
                    }  );
                }
                else
                alert("Login first");
          }
        }
        else
         alert("Login first!");
      });
          });

        </script>

    <!-- JS here -->
    <script src="js/vendor/modernizr-3.5.0.min.js"></script>
    <script src="js/vendor/jquery-1.12.4.min.js"></script>
    <script src="js/popper.min.js"></script>
    <script src="js/bootstrap.min.js"></script>
    <script src="js/owl.carousel.min.js"></script>
    <script src="js/isotope.pkgd.min.js"></script>
    <script src="js/ajax-form.js"></script>
    <script src="js/waypoints.min.js"></script>
    <script src="js/jquery.counterup.min.js"></script>
    <script src="js/imagesloaded.pkgd.min.js"></script>
    <script src="js/scrollIt.js"></script>
    <script src="js/jquery.scrollUp.min.js"></script>
    <script src="js/wow.min.js"></script>
    <script src="js/nice-select.min.js"></script>
    <script src="js/jquery.slicknav.min.js"></script>
    <script src="js/jquery.magnific-popup.min.js"></script>
    <script src="js/plugins.js"></script>
    <script src="js/gijgo.min.js"></script>

    <!--contact js-->
    <script src="js/contact.js"></script>
    <script src="js/jquery.ajaxchimp.min.js"></script>
    <script src="js/jquery.form.js"></script>
    <script src="js/jquery.validate.min.js"></script>
    <script src="js/mail-script.js"></script>
    <script src="index1.js"></script>
    <script src="js/main.js"></script>

</body>
</html>